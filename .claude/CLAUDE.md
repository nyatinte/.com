# Ultracite コード規約

このプロジェクトでは **Ultracite** を使用しています。これは、自動フォーマットとリント機能により厳格なコード品質基準を適用する、設定不要のBiomeプリセットです。

## クイックリファレンス

- **コードのフォーマット**: `pnpm ultracite fix`
- **問題のチェック**: `pnpm ultracite check`
- **セットアップの診断**: `pnpm ultracite doctor`

Biome(基盤となるエンジン)は、Rust製の超高速なリントとフォーマットを提供します。ほとんどの問題は自動で修正可能です。

---

## 基本原則

**アクセシブルで、パフォーマンスが高く、型安全で、保守可能な**コードを書くこと。簡潔さよりも、明確性と明示的な意図を重視します。

### 型安全性と明示性

- 明確性を高める場合は、関数のパラメータと戻り値に明示的な型を使用する
- 型が本当に不明な場合は、`any`よりも`unknown`を優先する
- 不変値とリテラル型には const アサーション(`as const`)を使用する
- 型アサーションではなく、TypeScriptの型の絞り込みを活用する
- マジックナンバーではなく意味のある変数名を使用する - 説明的な名前の定数を抽出する

### モダンなJavaScript/TypeScript

- コールバックや短い関数にはアロー関数を使用する
- `.forEach()`やインデックス付き`for`ループよりも`for...of`ループを優先する
- より安全なプロパティアクセスのためにオプショナルチェイニング(`?.`)とNull合体演算子(`??`)を使用する
- 文字列連結よりもテンプレートリテラルを優先する
- オブジェクトと配列の代入には分割代入を使用する
- デフォルトで`const`を使用し、再代入が必要な場合のみ`let`を使用、`var`は使用しない

### 非同期とPromise

- async関数内では必ずpromiseを`await`する - 戻り値を使用することを忘れない
- 可読性向上のため、promiseチェーンではなく`async/await`構文を使用する
- try-catchブロックで非同期コードのエラーを適切に処理する
- Promise executorとして非同期関数を使用しない

### React & JSX

- クラスコンポーネントよりも関数コンポーネントを使用する
- フックはトップレベルでのみ呼び出し、条件付きで呼び出さない
- フックの依存配列にすべての依存関係を正しく指定する
- イテラブルの要素には`key`プロップを使用する(配列のインデックスよりもユニークIDを優先)
- 子要素はpropsとして渡すのではなく、開始タグと終了タグの間にネストする
- 他のコンポーネント内でコンポーネントを定義しない
- アクセシビリティのためにセマンティックHTMLとARIA属性を使用する:
  - 画像に意味のあるalt属性を提供する
  - 適切な見出し階層を使用する
  - フォーム入力にラベルを追加する
  - マウスイベントと一緒にキーボードイベントハンドラを含める
  - roleを持つdivではなく、セマンティック要素(`<button>`、`<nav>`など)を使用する

### エラーハンドリングとデバッグ

- 本番コードから`console.log`、`debugger`、`alert`文を削除する
- 文字列や他の値ではなく、説明的なメッセージを持つ`Error`オブジェクトをスローする
- `try-catch`ブロックを意味のある形で使用する - エラーを再スローするためだけにキャッチしない
- エラーケースには、ネストした条件分岐よりもアーリーリターンを優先する

### コード構成

- 関数は焦点を絞り、妥当な認知的複雑性の限界内に収める
- 複雑な条件は、適切に命名されたboolean変数に抽出する
- ネストを減らすためにアーリーリターンを使用する
- ネストした三項演算子よりもシンプルな条件分岐を優先する
- 関連するコードをまとめ、関心事を分離する

### セキュリティ

- リンクで`target="_blank"`を使用する際は`rel="noopener"`を追加する
- 絶対に必要な場合を除き`dangerouslySetInnerHTML`を避ける
- `eval()`を使用せず、`document.cookie`に直接代入しない
- ユーザー入力を検証およびサニタイズする

### パフォーマンス

- ループ内のアキュムレータでスプレッド構文を避ける
- ループ内で正規表現を作成するのではなく、トップレベルの正規表現リテラルを使用する
- 名前空間インポートよりも特定のインポートを優先する
- バレルファイル(すべてを再エクスポートするインデックスファイル)を避ける
- `<img>`タグよりも適切な画像コンポーネント(例:Next.jsの`<Image>`)を使用する

### フレームワーク固有のガイダンス

**Next.js:**
- 画像にはNext.jsの`<Image>`コンポーネントを使用する
- head要素には`next/head`またはApp Router metadata APIを使用する
- 非同期のClient Componentsではなく、Server Componentsを非同期データフェッチに使用する

**React 19+:**
- `React.forwardRef`ではなく、refをpropsとして使用する

**Solid/Svelte/Vue/Qwik:**
- `className`や`htmlFor`ではなく、`class`と`for`属性を使用する

---

## テスト

- `it()`または`test()`ブロック内にアサーションを記述する
- 非同期テストでdoneコールバックを避ける - 代わりにasync/awaitを使用する
- コミットされたコードで`.only`や`.skip`を使用しない
- テストスイートを適度にフラットに保つ - 過度な`describe`のネストを避ける

## Biomeが対応できないこと

Biomeのリンターはほとんどの問題を自動的にキャッチします。以下に注意を向けてください:

1. **ビジネスロジックの正確性** - Biomeはアルゴリズムを検証できない
2. **意味のある命名** - 関数、変数、型に説明的な名前を使用する
3. **アーキテクチャの決定** - コンポーネント構造、データフロー、API設計
4. **エッジケース** - 境界条件とエラー状態を処理する
5. **ユーザーエクスペリエンス** - アクセシビリティ、パフォーマンス、ユーザビリティの考慮
6. **ドキュメント** - 複雑なロジックにはコメントを追加するが、自己文書化されたコードを優先する

---

ほとんどのフォーマットと一般的な問題はBiomeによって自動的に修正されます。コミット前に`pnpm ultracite fix`を実行してコンプライアンスを確保してください。
